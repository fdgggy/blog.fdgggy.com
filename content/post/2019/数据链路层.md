---
title: "数据链路层"
date: 2019-11-17T16:05:08+08:00
description: "计算机网络数据链路层"
tags:
- 数据链路层
categories:
 - 计算机网络
keywords:
 - 数据链路层
toc: true
url: "/2019/11/17/lianluceng/"

---
### 概述
* 物理层上方的一种能正确且稳定的传输比特流的结构
，能生成通往相邻设备的逻辑传输路径(数据链路)，并检查其中的传输错误并修复
* 数据链路层将来自网络层的数据包封装成帧后交给物理层
  1、为网络层IP模块发送和接收IP数据报
  2、为网络层ARP模块发送ARP请求和接收ARP应答
* 数据链路层接收来自物理层比特流做一个和成帧相反的处理，交给网络层
![46208c8793a1fc09e5b1b50b2d4dcd81](/img/hugo/2019/数据链路层.resources/8F543A9B-37CC-4455-9C3B-BA81F302D719.png)

### 包，帧，数据报，段，消息
都是用来描述数据的单位，包是全能型术语，帧表示数据链路层中包的单位。数据报是IP网络层和UDP包的单位。段表示TCP数据流中的数据。消息是应用层协议中的数据单位。
数据链路层会对从网络层的数据报封装处理，这种封装处理叫作成帧，封装后的数据叫作帧。
### MAC地址
* 用于识别数据链路中的互联节点。以太网，FDDI，ATM无线LAN，蓝牙等设备都根据IEEE802.3(美国电气和电子工程协会，制定局域网标准化相关规范的组织)规范使用MAC地址。
* MAC地址长48比特，6个字节的16进制数表示。
![94e79160b7018bf4a600b274a4a6e350](/img/hugo/2019/数据链路层.resources/19F74DA4-6A15-4CB6-BAAC-83CDFED4CA0D.png)
MAC地址的3-24位表示厂商识别码，一个厂商可以有多个，25-48位是厂商内部识别码，因此，可以保证全世界不会有相同的MAC地址的网卡。(MAC地址并不总是唯一的，只要不是同一个数据链路就不会有问题，如一台主机上启动多个虚拟机，由虚拟软件设定MAC地址给多个虚拟网卡，这就很难保证所生成的MAC地址是独一无二的了)
### 数据链路举例
* 按照一种链路协议连接2个或多个数据站点的电信设施叫作数据链路。包括物理线路和控制数据传输的通信协议。
* ATM 面向连接的一种数据链路，通信之前一定要设置通信线路，与传统电话相似
![9381b703d6b2acca26f5000dbbe4c2ec](/img/hugo/2019/数据链路层.resources/068EFA8E-5D37-4E2D-9983-B0DD25FF2A70.png)
* FDDI 分布式光线数据接口。采用令牌环的访问方式，在网络拥堵的情况下极容易导致网络收敛。
![5de715b550e3bf1c0bee3808ddcd0f3b](/img/hugo/2019/数据链路层.resources/BDFCBC46-0B67-4BC0-87F6-0FDE17B01DD5.png)
* ppp 点对点，1对1连接计算机的协议。属于纯粹的数据链路层，与物理层没任何关系。2台机器通信还需要物理层支持。
![6e92000c73da079143fbaba6f06bc34b](/img/hugo/2019/数据链路层.resources/39556C70-F9A9-41BC-91B8-DB1DE325FAC6.png)
ppp可以使用电话线，专线，ATM线路等。
* 无线通信
使用电磁波，红外线，激光灯方式进行传播数据。无线通信的种类
![8d2d24e58aa54ebcf638d86821db9f84](/img/hugo/2019/数据链路层.resources/90F5EC7C-FA28-41F0-A96D-5BB77D23A2BB.png)
![f3e80cd9ccaba12b1be7edd89263edda](/img/hugo/2019/数据链路层.resources/C391FCA7-D3ED-429D-83D4-AFBB72735B43.png)

### 以太网
* 概念
 IEEE802.3标准制定了以太网的技术标准，规定了包括物理层的连线通信，电子信号和介质访问层协议的内容。分为两类：1.经典以太网，运行速度3-10Mbps 2.交换式以太网，使用交换机连接不同的计算机，可运行在100，1000和10000Mbps高速率的快速以太网，千兆以太网和万兆以太网上。
 
在很多数据链路中最著名的，使用最广泛的就是以太网(Ethernet)，规范简单，易于NIC(网卡)及驱动程序的实现。是数据链路层的一种规范方式，取代了其他局域网技术如令牌环，FDDI等。  

* 共享介质型。
![448268cf37194823b9e20b184f74bbd7](/img/hugo/2019/数据链路层.resources/1373D6AD-87F1-4C03-A7A7-5D95789980DD.png)
共享介质型网络指多个设备共享一个通信介质的一种网络，设备之间使用同一个载波信道进行发送和接收，同时只能有一个设备占用。两种介质访问控制方式. 

一、争用方式 争夺获取数据传输的权利，也叫CSMA(载波监听多路访问)，网络中各个站点先到先得的方式占用信道发送数据，如果多个站同时发送帧，则会发生冲突现象，导致网络拥堵与性能下降
![ae8d9d226d3d36d331f7faf0b7f57bbc](/img/hugo/2019/数据链路层.resources/80A0914E-3BDA-4489-89C8-EFFEA4E19A72.png)
改良CSMA的另一种方式CSMA/CD，工作原理：
1.如果载波信道上没有数据，则任何站都可以发送数据
2.检查是否发生冲突，一旦发送冲突，放弃发送数据，立即释放载波信道
3.放弃发送以后，随机延时一段时间，再重新争用介质，重新发送帧。
![33b1831decf01d21223faff701870c4b](/img/hugo/2019/数据链路层.resources/64C8A4B4-BE4D-402A-9634-F729986DC1FE.png). 


二、令牌传递
只有获得令牌的站才能发送数据，一是不会有冲突，二是每个站都有通过平等循环获得令牌的机会。缺点是在网络不拥堵的情况下数据链路的利用率达不到100%。
![2ad2a0a9083cf9c541a5b692affa4abe](/img/hugo/2019/数据链路层.resources/2F0E306A-FEA2-4E31-8433-2A6E4E096930.png) 

* 非共享介质网络
网络中每个站直连交换机，由交换机负责转发数据帧，实现全双工通信。发送端和接收端不共享通信介质。
![06b133f78e7218f346210cd950473b67](/img/hugo/2019/数据链路层.resources/C5C07289-095E-47D5-9E63-9F2217A9D5D5.png)
现在互联设备都采用终端和交换机之间独占电缆的方式实现以太网通信。
![7a1f17c7eba4b93fd25bc777c40cf9ee](/img/hugo/2019/数据链路层.resources/619F1687-2B6C-43A7-8E6D-83022A9CC688.png)
### 以太网分类
以太网因通信电缆的不同和通信速度的诧异，有很多不同的以太网类型。在传输速度相同而传输电缆不同的情况下，可以连接中继器或集线器中转，而在传输速度不同的情况下，必须采用网桥，交换集线器或路由器来变更速度。
![e8efa642cf288fc2ae6051ff7fb40528](/img/hugo/2019/数据链路层.resources/3AC13C8D-2D0A-43B7-B7C9-C677376FCE27.png)
![c11e5061bc42b875e3aefc96f9c06e53](/img/hugo/2019/数据链路层.resources/CCE10846-1112-45DF-8AC7-4FD2D19D7583.png)
### 以太网帧格式
* RFC 894格式，最常用的格式
![501dc9ad56c35290529a5cb1109863cd](/img/hugo/2019/数据链路层.resources/84F1D832-2F54-4DE2-AB2B-69692AEEA79A.png)  

1、前导码相当于发送帧的信号.  
2、帧头由目的MAC,源MAC和类型组成.  
类型决定数据部分的网络层的数据包使用的协议类型
![22654fbd01ae67deeb7fa2b8d50f6555](/img/hugo/2019/数据链路层.resources/68F2229B-2C3A-4F31-875C-9364BCCA68B6.png)
3、FCS(帧校验序列)用来检查数据正确性。发送方在发送时会对帧头和数据进行CRC(循环冗余检测)校验，并将结果添加到FCS中，接收方接收信息时会再次进行同样的计算，两者结果一致则认为帧是正确的，不一致则会将数据丢弃。
### 数据传播类型
* 单播 一对一通信，对应某个节点只生成一条数据链路，现代以太网环境中占比很大。Email和互联网通信就是。
 ![946016864d9c5b11c5beebc8f8030442](/img/hugo/2019/数据链路层.resources/38A585FA-CEB9-4E64-A900-B095A7F5598E.png)
* 广播 一对多的通信，多是指同一个网络中的所有节点。广播能够波及的范围叫作广播域。目的MAC地址是FF-FF-FF-FF-FF-FF。ARP(地址解析协议)就是一个典型的广播通信。
![43bf3cd6e0974fe5a20ab498dd422195](/img/hugo/2019/数据链路层.resources/31E48D86-6684-42F0-9A83-A94251B466C4.png)
* 多播 一对多的通信，多是指特定小组(多播组)中的节点。如果某个节点发送了多播信息，那么这个小组中的所有节点都会收到该信息。多播用于视频发布和证券交易所的应用程序。
### L2交换机
* OO交换机的OO代表OSI参考模型的层，表示它们是根据哪一层的信息去切换转发地址。L2交换机根据数据链路层的信息，就是MAC地址信息对帧进行L2交换。
![9e8125051e8bf695d6729ceeedee690b](/img/hugo/2019/数据链路层.resources/52C0434D-B0AF-4CE0-9F66-904E3E4B854C.png)
* 作用：1.登记收到的帧的端口和源MAC地址，将来路不明的MAC地址进行泛洪处理，删除不再需要的信息。
#### 工作原理
L2交换机根据内存中的MAC地址表对帧进行交换，MAC地址表由端口和源MAC地址的信息构成。
* 节点A将数据包封装成帧并传递给线缆，目的发给节点B。
![42b211afae8448979fe378319d41a1e9](/img/hugo/2019/数据链路层.resources/99A5E6AC-5D0A-4FFF-AFD8-79543F9CF93D.png)
* 交换机收到帧后，将节点A的端口号和源MAC地址作为新的条目添加到MAC地址表中。MAC地址表一开始是空的，从空表的状态开始学习帧并不断添加新的数据。
![f66a758fe2c783fd71500c25f78a7322](/img/hugo/2019/数据链路层.resources/C06DE58D-1ECB-4AB2-95F3-1415289B763F.png)
* 交换机并不知道节点B的MAC地址，所以会将帧复制并发送给不与节点A连接的所有端口。把帧同时发送给多个端口的行为叫做泛洪。
![a8755bf8101f08a9a498bda928b64789](/img/hugo/2019/数据链路层.resources/91D16EFD-9900-4C42-9F8F-E01CDB7B733F.png)
* 节点B收到帧后认为这是发给自己的帧，为了回应A，也会生成一个帧并传递给线缆。节点C和节点D判断出这不是自己的帧然后丢弃。
![878c2a63bd84334a399577adc3a601ef](/img/hugo/2019/数据链路层.resources/271D2E76-AC76-4BC2-887A-0CEF69193FE0.png)
* 交换机收到帧后，将节点B的端口号和MAC地址登记到MAC地址表中。根据MAC地址表中的登记内容，发给节点A的帧会马上转发到1号端口。MAC地址生成后，节点A和节点B之间的帧转发就不会影响到其他节点，能高效快速的进行通信了。
![dd96dc63c9389a4616940a9c7f038a7e](/img/hugo/2019/数据链路层.resources/E4A06BF3-52DE-4B21-A7DF-BBC58F58EF40.png)
* MAC地址表建立后，里面的条目并不是一直保留。
1.与端口相连的线缆被拔掉时
2.超过一定时间未收到帧时，思科Catalyst交换机默认时间未300s。
![802e3213f0ad7ce2233a2955122e8de6](/img/hugo/2019/数据链路层.resources/ACC4DB4B-DEAD-4746-BEEE-55FAD17916EE.png)
### ARP协议
地址解析协议(ARP)用于实现IP地址到网络接口硬件地址的映射。ARP协议在RFC826中定义。
![13b33686261a2d526f1933ff9240ecd2](/img/hugo/2019/数据链路层.resources/04B19422-AB50-4573-81DD-10570A933733.png)

#### ARP工作原理
数据链路层收到网络层的IP数据包后，因为不知道目标MAC地址，所以并不清楚该如何封装成帧。
![6960bf8b6e8e8a5dd2be19911b6bcea4](/img/hugo/2019/数据链路层.resources/2FDC821A-8A3B-445A-A4D2-2320F7CF6F29.png)

* 先查看IP数据包的目的IP地址，如果是同一网段的节点，就查询该IP地址的MAC地址。如果不是同一网段的节点，就去查询默认网关的MAC地址。
* 默认网关(路由器)是通往非本地网段的出口，如果数据包是发给非本地的其他网段而且并不清楚目的IP地址，则直接发给默认网关。
![4de5f3c4463f3439438bd6f301de32df](/img/hugo/2019/数据链路层.resources/EB83D0EC-2F3D-44A0-844F-55AFF39270E1.png)
* 通过高速缓存查询MAC地址。ARP查询到对方节点MAC地址后，会在ARP表中添加新的条目并将其暂时保存，超过一定时间后则会删除。Windows7默认是10分钟，思科设备默认是4小时。arp -a查看所有ARP高速缓存。



















































